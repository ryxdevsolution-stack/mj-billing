# üöÄ Render Deployment Guide - RYX Billing System

Complete guide to deploy your RYX Billing application on Render with both backend and frontend.

---

## üìã Prerequisites

- [ ] GitHub account with your repository
- [ ] Render account (sign up at [render.com](https://render.com))
- [ ] Supabase account with database setup (or Render PostgreSQL)

---

## üóÇÔ∏è Project Structure

```
mj-billing/
‚îú‚îÄ‚îÄ backend/              # Flask API
‚îú‚îÄ‚îÄ frontend/             # Next.js UI
‚îú‚îÄ‚îÄ migration/           # SQL database migrations
‚îú‚îÄ‚îÄ render.yaml          # Render configuration (auto-deploy)
‚îú‚îÄ‚îÄ .env.example         # Environment variables template
‚îî‚îÄ‚îÄ DEPLOYMENT.md        # This file
```

---

## üîë Environment Variables Required

### Backend Service Variables

| Variable | Description | Example | Required |
|----------|-------------|---------|----------|
| `DB_URL` | PostgreSQL connection string | `postgresql://user:pass@host:5432/db` | ‚úÖ Yes |
| `SUPABASE_URL` | Supabase project URL | `https://xxx.supabase.co` | ‚úÖ Yes |
| `SUPABASE_KEY` | Supabase anon key | `eyJhbGci...` | ‚úÖ Yes |
| `JWT_SECRET` | JWT signing secret | Auto-generated by Render | ‚úÖ Yes |
| `SECRET_KEY` | Flask secret key | Auto-generated by Render | ‚úÖ Yes |
| `CORS_ORIGINS` | Allowed frontend URLs | `https://your-app.onrender.com` | ‚úÖ Yes |
| `DEBUG` | Debug mode | `False` | ‚ö†Ô∏è Auto-set |

### Frontend Service Variables

| Variable | Description | Example | Required |
|----------|-------------|---------|----------|
| `NEXT_PUBLIC_API_URL` | Backend API URL | `https://backend.onrender.com` | ‚úÖ Yes |
| `NODE_ENV` | Node environment | `production` | ‚ö†Ô∏è Auto-set |

---

## üìù Step-by-Step Deployment

### Step 1: Prepare Your Supabase Database

1. **Go to Supabase Dashboard**: [supabase.com/dashboard](https://supabase.com/dashboard)
2. **Create/Select Project**
3. **Get Database Credentials**:
   - Go to **Settings** ‚Üí **Database**
   - Copy **Connection string** (URI format)
   - Example: `postgresql://postgres:password@db.xxx.supabase.co:5432/postgres`

4. **Get API Credentials**:
   - Go to **Settings** ‚Üí **API**
   - Copy **Project URL**: `https://xxx.supabase.co`
   - Copy **anon/public key**: Starts with `eyJhbGci...`

5. **Run Database Migrations**:
   - Go to **SQL Editor** in Supabase
   - Run the SQL file: `migration/RUN_THIS_IN_SUPABASE.sql`
   - This creates all tables, triggers, and sample data

### Step 2: Connect Repository to Render

1. **Sign up/Login to Render**: [render.com](https://render.com)
2. **Connect GitHub**:
   - Click **New** ‚Üí **Blueprint**
   - Select **Connect a repository**
   - Authorize Render to access your GitHub
   - Select `mj-billing` repository

3. **Render will auto-detect** the `render.yaml` file

### Step 3: Configure Backend Service

After Render creates services from `render.yaml`:

1. **Go to Backend Service** (`ryx-billing-backend`)
2. **Go to Environment tab**
3. **Add/Update these variables**:

```bash
DB_URL=postgresql://postgres:YOUR_PASSWORD@db.xxxxx.supabase.co:5432/postgres
SUPABASE_URL=https://xxxxx.supabase.co
SUPABASE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3M...
CORS_ORIGINS=https://YOUR-FRONTEND-APP.onrender.com
```

> **Note**: `JWT_SECRET` and `SECRET_KEY` are auto-generated by Render (from render.yaml)

4. **Save** and wait for automatic redeploy

### Step 4: Configure Frontend Service

1. **Go to Frontend Service** (`ryx-billing-frontend`)
2. **Go to Environment tab**
3. **Add this variable**:

```bash
NEXT_PUBLIC_API_URL=https://YOUR-BACKEND-APP.onrender.com
```

4. **Get Backend URL**:
   - Go to your backend service
   - Copy the URL (e.g., `https://ryx-billing-backend.onrender.com`)

5. **Update Frontend Environment**:
   ```bash
   NEXT_PUBLIC_API_URL=https://ryx-billing-backend.onrender.com
   ```

6. **Save** and wait for redeploy

### Step 5: Update Backend CORS

After frontend is deployed:

1. **Get Frontend URL** (e.g., `https://ryx-billing-frontend.onrender.com`)
2. **Go to Backend Service** ‚Üí **Environment**
3. **Update CORS_ORIGINS**:
   ```bash
   CORS_ORIGINS=https://ryx-billing-frontend.onrender.com
   ```
4. **Save** and redeploy

---

## ‚úÖ Testing Your Deployment

### Backend Health Check

```bash
curl https://your-backend.onrender.com/
```

Expected response:
```json
{
  "message": "RYX Billing API is running",
  "status": "healthy"
}
```

### Frontend Check

Visit: `https://your-frontend.onrender.com`

You should see the login page.

### Test Login

Use the default test account created by migration:
- **Email**: `admin@test.com`
- **Password**: `admin123`

---

## üîß Troubleshooting

### Issue: Backend Returns 500 Error

**Solution**:
1. Check Render logs: Backend service ‚Üí **Logs** tab
2. Verify environment variables are set correctly
3. Check Supabase connection string format

### Issue: Frontend Shows "API Connection Error"

**Solution**:
1. Verify `NEXT_PUBLIC_API_URL` points to correct backend URL
2. Check backend CORS settings include frontend URL
3. Ensure backend is running (check backend service status)

### Issue: Database Connection Failed

**Solution**:
1. Verify `DB_URL` format: `postgresql://user:pass@host:5432/db`
2. Check Supabase database is running
3. Verify IP allowlist in Supabase (should allow all for Render)

### Issue: Free Tier Services Sleep

**Render Free Tier** services spin down after 15 minutes of inactivity:
- ‚è±Ô∏è **First request**: ~30 seconds cold start
- ‚ö° **Subsequent requests**: Instant

**Solutions**:
1. Use a ping service (e.g., UptimeRobot) to keep alive
2. Upgrade to paid tier ($7/month per service)
3. Accept cold starts for low-traffic testing

### Issue: Build Failed

**Common causes**:
1. **Backend**: Missing dependencies in `requirements.txt`
2. **Frontend**: Node version mismatch (should be 18)
3. **Check build logs** in Render dashboard

---

## üìä Monitoring & Logs

### View Logs

1. **Backend Logs**:
   - Go to backend service ‚Üí **Logs** tab
   - Real-time application logs

2. **Frontend Logs**:
   - Go to frontend service ‚Üí **Logs** tab
   - Build and runtime logs

### Metrics

- **Dashboard**: View request counts, response times
- **Events**: See deploys, restarts, errors

---

## üí∞ Cost Breakdown (Render Free Tier)

| Service | Cost | Limitations |
|---------|------|-------------|
| Backend Web Service | **FREE** | Spins down after 15min, 750 hours/month |
| Frontend Web Service | **FREE** | Spins down after 15min, 750 hours/month |
| PostgreSQL (via Supabase) | **FREE** | 500MB database, 2GB transfer |

**Total Monthly Cost**: **$0** (Free tier)

To avoid spin-down: **$7/month** per service ($14 total)

---

## üîÑ Updating Your App

### Automatic Deploys

Render auto-deploys when you push to your GitHub repository:

1. **Make changes** to your code
2. **Commit and push** to GitHub:
   ```bash
   git add .
   git commit -m "Update feature"
   git push origin main
   ```
3. **Render auto-deploys** within 1-2 minutes

### Manual Deploy

From Render dashboard:
1. Go to service
2. Click **Manual Deploy** ‚Üí **Deploy latest commit**

---

## üõ°Ô∏è Security Best Practices

1. ‚úÖ **Never commit** `.env` files
2. ‚úÖ **Use Render secrets** for sensitive data
3. ‚úÖ **Change default** JWT_SECRET and SECRET_KEY
4. ‚úÖ **Enable HTTPS** only (Render does this automatically)
5. ‚úÖ **Limit CORS** to your frontend domain only
6. ‚úÖ **Regular security** updates

---

## üìö Additional Resources

- **Render Docs**: [docs.render.com](https://docs.render.com)
- **Next.js Deployment**: [nextjs.org/docs/deployment](https://nextjs.org/docs/deployment)
- **Flask Deployment**: [flask.palletsprojects.com/deploying](https://flask.palletsprojects.com/deploying/)
- **Supabase Docs**: [supabase.com/docs](https://supabase.com/docs)

---

## üéâ Success!

Your RYX Billing System is now live!

- **Backend API**: `https://ryx-billing-backend.onrender.com`
- **Frontend App**: `https://ryx-billing-frontend.onrender.com`

**Default Login**:
- Email: `admin@test.com`
- Password: `admin123`

---

## üÜò Need Help?

- Check **Render Logs** first
- Review **Supabase Dashboard** for database issues
- Verify **Environment Variables** are correct
- Contact support or check GitHub issues

---

**Happy Deploying! üöÄ**
